const _$=document.querySelector.bind(document),_$$=document.querySelectorAll.bind(document),_$$$=document.getElementById.bind(document);async function fcn_ajaxPost(t={},e=null,n={}){e&&!e.startsWith("http")&&(e=FcnGlobals.restURL+e),e=e||FcnGlobals.ajaxURL;let o={"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"};o={...o,...n},t={nonce:fcn_getNonce(),...t};const i=await fetch(e,{method:"POST",credentials:"same-origin",headers:o,mode:"same-origin",body:new URLSearchParams(t)});return i.ok?i.json():Promise.reject(i)}async function fcn_ajaxGet(t={},e=null,n={}){e&&!e.startsWith("http")&&(e=FcnGlobals.restURL+e),e=e||FcnGlobals.ajaxURL,e=fcn_buildUrl(t={nonce:fcn_getNonce(),...t},e);let o={"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"};o={...o,...n};const i=await fetch(e,{method:"GET",credentials:"same-origin",headers:o,mode:"same-origin"});return i.ok?i.json():Promise.reject(i)}function fcn_copyToClipboard(t,e=!1){e=e||fictioneer_tl.notification.copiedToClipboard,navigator.clipboard&&(navigator.clipboard.writeText(t),e&&fcn_showNotification(e,2))}function fcn_parseJSON(t){if(null==t||"string"!=typeof t)return null;try{return JSON.parse(t)}catch(t){return null}}function fcn_removeItemOnce(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),t}function fcn_clamp(t,e,n){return Math.min(Math.max(n,t),e)}function fcn_updateThemeColor(t=!1){const e=fcn_siteSettings.darken?fcn_siteSettings.darken:0,n=fcn_siteSettings.saturation?fcn_siteSettings.saturation:0,o=fcn_siteSettings["hue-rotate"]?fcn_siteSettings["hue-rotate"]:0,i=e>=0?1+e**2:1-e**2,c=n>=0?1+n**2:1-n**2;let a=getComputedStyle(document.documentElement).getPropertyValue("--theme-color-base").trim().split(" ");a=`hsl(${(parseInt(a[0])+o)%360}deg ${(parseInt(a[1])*c).toFixed(2)}% ${(parseInt(a[2])*i).toFixed(2)}%)`,_$("meta[name=theme-color]").setAttribute("content",t||a)}function fcn_offset(t){const e=t.getBoundingClientRect();return{top:e.top+window.scrollY,left:e.left+window.scrollX}}function fcn_throttle(t,e,n){var o,i,c,a=null,s=0;n||(n={});var r=function(){s=!1===n.leading?0:Date.now(),a=null,c=t.apply(o,i),a||(o=i=null)};return function(){var l=Date.now();s||!1!==n.leading||(s=l);var u=e-(l-s);return o=this,i=arguments,u<=0||u>e?(a&&(clearTimeout(a),a=null),s=l,c=t.apply(o,i),a||(o=i=null)):a||!1===n.trailing||(a=setTimeout(r,u)),c}}var fcn_animFrameEvents=new Map;function fcn_bindEventToAnimationFrame(t,e,n=window){n.addEventListener(t,(function(){fcn_animFrameEvents.get(e)||(fcn_animFrameEvents.set(e,!0),requestAnimationFrame((()=>{n.dispatchEvent(new CustomEvent(e)),fcn_animFrameEvents.set(e,!1)})))}))}function fcn_cleanTextSelectionFromButtons(t){return t=(t=(t=(t=(t=(t=t.replace(/[\r\n]{2,}/g,"__$__")).replace(new RegExp("(__Bookmark|__Quote|__Link)","g"),"")).replace(new RegExp("(__Bookmark|__Quote|__TTS|__Link)","g"),"")).replace(new RegExp("(__Bookmark|__Quote|__Suggestion|__TTS|__Link)","g"),"")).replace(new RegExp("(__Bookmark|__Quote|__Suggestion|__Link)","g"),"")).replace(/[__$]{1,}/g,"\n\n").replace(/^[\r\n]+|[\r\n]+$/g,"")}function fcn_deleteCookie(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/"}function fcn_deleteAllCookies(){localStorage.clear(),document.cookie.split(";").forEach((t=>{document.cookie=t.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}))}function fcn_setCookie(t,e,n=30){const o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);const i="expires="+o.toUTCString();document.cookie=t+"="+encodeURIComponent(e)+";"+i+";SameSite=Strict;path=/"}function fcn_getCookie(t){const e=t+"=",n=document.cookie.split(";");for(var o=0;o<n.length;o++){const t=n[o].trim();if(0==t.indexOf(e))return decodeURIComponent(t.substring(e.length,t.length))}return null}function fcn_getNonce(){return _$$$("fictioneer-ajax-nonce")?.value??_$$$("general-fictioneer-nonce")?.value??_$('[name="fictioneer_nonce"]')?.value??0}function fcn_buildUrl(t={},e=null){return e=e?new URL(e):new URL(window.location.protocol+"//"+window.location.host+window.location.pathname),t&&Object.keys(t).forEach((n=>{e.searchParams.append(n,t[n])})),e}function fcn_buildErrorNotice(t,e=!1,n=!0){console.error("Error:",t);const o=document.createElement("div");let i=t;return e&&(o.id=e),o.classList="notice _warning","object"==typeof t&&(i="",t.status&&(i=`${t.status}: `),t.statusText&&(i+=t.statusText),i||(i="Unknown error.")),o.innerHTML=`<i class="fa-solid fa-triangle-exclamation"></i><div>${n?fcn_sanitizeHTML(i):i}</div>`,o}function fcn_sanitizeHTML(t){const e=document.createElement("div");return e.innerText=t instanceof HTMLElement?t.innerHTML:t,e.textContent="string"==typeof t?t:t.textContent,e.innerHTML}function fcn_detectScreenCollision(t){const e=t.getBoundingClientRect(),n=window.innerHeight??document.documentElement.clientHeight,o=window.innerWidth??document.documentElement.clientWidth,i=(t.closest(".popup-menu-toggle")?.clientHeight??32)+16,c=n-e.bottom,a=[];return e.top<=50&&c>50+i&&a.push("top"),e.bottom>=n-50&&e.top>50+i&&a.push("bottom"),e.left<=10&&a.push("left"),e.right>=o-10&&a.push("right"),a}function fcn_scrollTo(t,e=64){window.scrollTo({top:t.getBoundingClientRect().top+window.scrollY-e,behavior:"smooth"})}function fcn_html(...t){const e=document.createElement("template");return e.innerHTML=String.raw(...t).trim(),e.content.firstChild}function fcn_isSearchEngineCrawler(){const t=navigator.userAgent.toLowerCase();return["googlebot","bingbot","slurp","duckduckbot","baiduspider","yandexbot","sogou","exabot","facebot","ia_archiver"].some((e=>t.includes(e)))}function fcn_toggleInProgress(t,e=null){(e=null!==e?e:!t.disabled)?(t.dataset.enableWith=t.innerHTML,t.innerHTML=t.dataset.disableWith??"Processing",t.disabled=!0,t.classList.add("disabled")):(t.innerHTML=t.dataset.enableWith,t.disabled=!1,t.classList.remove("disabled"))}function fcn_adjustTextarea(t){t&&(t.style.height="auto",t.style.height=`${t.scrollHeight}px`)}application.register("fictioneer-last-click",class extends Stimulus.Controller{static get targets(){return["toggle"]}last=null;connect(){document.addEventListener("fcnRemoveLastClicked",(()=>{this.last&&this.removeLastClick()}))}removeAll(){this.last&&(this.#t(this.last,!1),this.removeLastClick())}toggle(t){const e=t.target.closest('[data-fictioneer-last-click-target="toggle"]');if(!e||["BUTTON","A","INPUT","SELECT"].includes(t.target.tagName)&&!t.target.hasAttribute("data-fictioneer-last-click-target"))return;const n=!e.classList.contains("last-clicked");"function"==typeof fcn_popupPosition&&fcn_popupPosition(),e.classList.toggle("last-clicked",n),e.closest(".watch-last-clicked")?.classList.toggle("has-last-clicked",n),this.last&&this.last!=e&&this.removeLastClick(),this.last=e,this.#t(e,n),t.stopPropagation()}removeLastClick(){this.last&&(this.last.closest(".watch-last-clicked")?.classList.remove("has-last-clicked"),this.last.classList.remove("last-clicked"),this.last=null,document.activeElement?.blur())}#t(t,e){document.dispatchEvent(new CustomEvent("toggledLastClick",{detail:{target:t,force:e}}))}});